<div class="eav-dialog">
  <div class="eav-dialog-header">
    <div class="eav-dialog-header__title">
      Create Metadata
    </div>
    <button mat-icon-button tippy="Close dialog" (click)="closeDialog()">
      <mat-icon>close</mat-icon>
    </button>
  </div>
  <div class="eav-dialog-content">
    <p>
      This is a special operation to add an item which as metadata for another item,
      see <a href="https://go.2sxc.org/metadata" target="_blank">docs</a>.
    </p>
    <form [formGroup]="form">
      <!-- Scope -->
      @if (advancedMode && guidedContentType) {
      <mat-form-field color="accent" class="eav-mat-form-field">
        <mat-label>Scope</mat-label>
        <mat-select formControlName="scope" [placeholder]="!scopeOptions().length ? 'No items found' : ''">
          @for (scopeOption of scopeOptions(); track scopeOption) {
          <mat-option [value]="scopeOption.value">
            {{ scopeOption.name }}
          </mat-option>
          }
          <mat-option [value]="dropdownInsertValue">Other...</mat-option>
        </mat-select>
      </mat-form-field>
      <app-field-hint>
        The scope should almost never be changed -
        <a href="https://2sxc.org/help?tag=scope" target="_blank" appClickStopPropagation>see help</a>
      </app-field-hint>
      }

      <!-- Content Type of metadata item -->
      <mat-form-field color="accent" class="eav-mat-form-field">
        <mat-label>Content Type</mat-label>
        @if (guidedContentType) {
        <mat-select formControlName="contentType" required
          [placeholder]="!contentTypes()?.length ? 'No items found' : ''">
          @for (contentType of contentTypes(); track contentType) {
          <mat-option [value]="contentType.NameId">
            {{ contentType.Label }}
          </mat-option>
          }
        </mat-select>
        }
        @if (!guidedContentType) {
        <input matInput type="text" formControlName="contentType" required>
        }
        <div matTextSuffix>
          <button mat-icon-button type="button" [ngClass]="{ 'active': guidedContentType }" tippy="Pick existing value"
            (click)="toggleGuidedContentType(true)">
            <mat-icon>search</mat-icon>
          </button>
          <button mat-icon-button type="button" [ngClass]="{ 'active': !guidedContentType }" tippy="Manual entry"
            (click)="toggleGuidedContentType(false)">
            <mat-icon>text_fields</mat-icon>
          </button>
        </div>
      </mat-form-field>
      @if (form.controls.contentType.touched && form.controls.contentType.errors?.required) {
      <app-field-hint [isError]="true">
        This field is required
      </app-field-hint>
      }

      <mat-slide-toggle color="accent" [checked]="advancedMode" (change)="toggleAdvancedMode($event)">
        {{ advancedMode ? 'Advanced' : 'Simple' }}
      </mat-slide-toggle>
      
    </form>
  </div>
  <mat-dialog-actions align="end">
    <app-save-close-button-fab
      [ngClass]="!canSave() ? 'disabled' : ''"
      [disabled]="!canSave()"
      (action)="saveAndClose()"
    />
  </mat-dialog-actions>
</div>
