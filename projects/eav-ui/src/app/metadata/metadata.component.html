<ng-container *ngIf="viewModel$ | async as vm">
  <div class="nav-component-wrapper">
    <div mat-dialog-title>
      <div class="dialog-title-box">
        <div>{{ title || 'Metadata' }}</div>
        <button mat-icon-button tippy="Close dialog" (click)="closeDialog()">
          <mat-icon>close</mat-icon>
        </button>
      </div>
    </div>

    <p class="dialog-description">
      <ng-container *ngIf="!vm.itemFor">This item is not metadata for anything else.</ng-container>
      <ng-container *ngIf="vm.itemFor">
        This item is metadata for:
        <br>Target: {{ vm.itemFor.Target }}
        <br>TargetType: {{ vm.itemFor.TargetType }}
        <ng-container *ngIf="vm.itemFor.Number"><br>Number: {{ vm.itemFor.Number }}</ng-container>
        <ng-container *ngIf="vm.itemFor.Guid"><br>Guid: {{ vm.itemFor.Guid }}</ng-container>
        <ng-container *ngIf="vm.itemFor.String"><br>String: {{ vm.itemFor.String }}</ng-container>
        <ng-container *ngIf="vm.itemFor.Title"><br>Title: {{ vm.itemFor.String }}</ng-container>
      </ng-container>
    </p>

    <router-outlet></router-outlet>

    <div class="grid-wrapper">
      <ag-grid-angular class="ag-theme-material" [rowData]="vm.metadata" [gridOptions]="gridOptions">
      </ag-grid-angular>

      <div class="grid-more-actions-box"></div>

      <button mat-fab mat-elevation-z24 class="grid-fab" *ngIf="vm.recommendations.length === 0"
        tippy="Create a new metadata for this item" (click)="createMetadata()">
        <mat-icon>add</mat-icon>
      </button>

      <eco-fab-speed-dial class="grid-fab" [ngClass]="{ 'fab-opened': vm.fabOpen }"
        *ngIf="vm.recommendations.length > 0" (openChange)="openChange($event)">
        <eco-fab-speed-dial-trigger [spin]="true">
          <button mat-fab>
            <mat-icon class="spin180">{{ vm.fabOpen ? 'close' : 'add' }}</mat-icon>
          </button>
        </eco-fab-speed-dial-trigger>

        <eco-fab-speed-dial-actions>
          <button mat-mini-fab label="Other Content Type" (click)="createMetadata()">
            <mat-icon>search</mat-icon>
          </button>
          <button mat-mini-fab *ngFor="let recommendation of vm.recommendations" [attr.label]="recommendation.Title"
            (click)="createMetadata(recommendation)">
            <div *ngIf="recommendation.Icon; then svgIcon else matIcon"></div>
            <ng-template #svgIcon>
              <div [innerHTML]="recommendation.Icon | safeHtml" [matBadgeHidden]="recommendation.Enabled"
                matBadgeColor="accent" matBadgeSize="small" matBadge="ðŸ’Ž" matBadgePosition="below after"></div>
            </ng-template>
            <!-- this is for all recommendations which don't have an own icon - they use the standard add-icon -->
            <ng-template #matIcon>
              <mat-icon>add</mat-icon>
            </ng-template>
          </button>
        </eco-fab-speed-dial-actions>
      </eco-fab-speed-dial>
    </div>
  </div>
</ng-container>