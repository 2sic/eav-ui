<mat-card>
  <mat-card-header>
    <mat-card-title>
      <span class="mat-headline">Recycle Bin (Beta)</span>
    </mat-card-title>
  </mat-card-header>
  <mat-card-content>
    <p class="mat-body-1">Here you can see and restore deleted items within this app.</p>
    <p class="mat-caption"><strong>Note:</strong> This feature is currently in beta and may not be fully stable. Use with caution.</p>

    <h3 class="mat-subtitle-1">
      Deleted Items ({{ deletedEntities().length }} total)

      <!-- Indicator if feature is not active -->
      <app-feature-icon [featureNameId]="'EntityUndelete'"></app-feature-icon>
    </h3>
    
    <div class="recycle-bin-filters">
      <mat-form-field appearance="outline" color="accent" class="recycle-bin-filter">
        <mat-label>Filter by Content Type</mat-label>
        <mat-select [(value)]="selectedContentType">
          <mat-option value="">All Types</mat-option>
          @for (type of contentTypes(); track type) {
            <mat-option [value]="type">{{ type }}</mat-option>
          }
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline" color="accent" class="recycle-bin-filter">
        <mat-label>Date range</mat-label>
        <mat-date-range-input [rangePicker]="dateRangePicker">
          <input matStartDate [(ngModel)]="dateRangeStart" placeholder="Start date" />
          <input matEndDate [(ngModel)]="dateRangeEnd" placeholder="End date" />
        </mat-date-range-input>
        <mat-datepicker-toggle matSuffix [for]="dateRangePicker"></mat-datepicker-toggle>
        <mat-date-range-picker #dateRangePicker></mat-date-range-picker>
      </mat-form-field>
    </div>

    <div>
      @if (deletedEntities().length === 0) {
        <p class="mat-body-1">No deleted items found</p>
      } @else {
        <table mat-table [dataSource]="deletedEntities()" class="mat-elevation-z2">

          <!-- Title Column -->
          <ng-container matColumnDef="Title">
            <th mat-header-cell *matHeaderCellDef>Title</th>
            <td mat-cell *matCellDef="let item">{{ item.title || '(no title)' }}</td>
          </ng-container>

          <!-- Content Type Column -->
          <ng-container matColumnDef="ContentTypeName">
            <th mat-header-cell *matHeaderCellDef>Content Type</th>
            <td mat-cell *matCellDef="let item">{{ item.contentTypeName || item.contentTypeStaticName }}</td>
          </ng-container>

          <!-- Deleted By Column -->
          <ng-container matColumnDef="DeletedBy">
            <th mat-header-cell *matHeaderCellDef>Deleted By</th>
            <td mat-cell *matCellDef="let item">{{ item.deletedBy }}</td>
          </ng-container>

          <!-- Deleted Date Column -->
          <ng-container matColumnDef="DeletedUtc">
            <th mat-header-cell *matHeaderCellDef>Deleted Date</th>
            <td mat-cell *matCellDef="let item">{{ item.deletedUtc | date: 'short' }}</td>
          </ng-container>

          <!-- Actions Column -->
          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef>Actions</th>
            <td mat-cell *matCellDef="let item">
              <button mat-raised-button color="primary" (click)="restore(item)">
                <mat-icon>restore_from_trash</mat-icon>
                Restore
              </button>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>
      }
    </div>
  </mat-card-content>
</mat-card>
<router-outlet></router-outlet>
