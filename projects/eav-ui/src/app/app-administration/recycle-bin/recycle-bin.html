<mat-card>
  <mat-card-header>
    <mat-card-title>
      <span class="mat-headline">Recycle Bin (Beta)</span>
    </mat-card-title>
  </mat-card-header>
  <mat-card-content>
    <p class="mat-body-1">Here you can see and restore deleted items within this app.</p>
    <p class="mat-caption"><strong>Note:</strong> This feature is currently in beta and may not be fully stable. Use with caution.</p>

    <h3 class="mat-subtitle-1">
      Deleted Items ({{ deletedEntities().length }} total)

      <!-- Indicator if feature is not active -->
      <app-feature-icon [featureNameId]="'EntityUndelete'"></app-feature-icon>
    </h3>
    
    <div class="recycle-bin-filters">
      <mat-form-field appearance="outline" color="accent" class="recycle-bin-filter">
        <mat-label>Filter by Content Type</mat-label>
        <mat-select [(value)]="selectedContentType">
          <mat-option value="">All Types</mat-option>
          @for (type of contentTypes(); track type.staticName) {
            <mat-option [value]="type.name">{{ type.title }}</mat-option>
          }
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline" color="accent" class="recycle-bin-filter">
        <mat-label>Date range</mat-label>
        <mat-date-range-input [rangePicker]="dateRangePicker">
          <input matStartDate [(ngModel)]="dateRangeStart" placeholder="Start date" />
          <input matEndDate [(ngModel)]="dateRangeEnd" placeholder="End date" />
        </mat-date-range-input>
        <mat-datepicker-toggle matSuffix [for]="dateRangePicker"></mat-datepicker-toggle>
        <mat-date-range-picker #dateRangePicker></mat-date-range-picker>
      </mat-form-field>
    </div>

    <div>
      @if (deletedEntities().length === 0) {
        <p class="mat-body-1">No deleted items found</p>
      } @else {
        <mat-accordion multi class="recycle-bin-list">
          @for (item of deletedEntities(); track item.id) {
            <mat-expansion-panel
              [expanded]="expandedItems[item.id]"
              (expandedChange)="toggleExpandItem($event, item.id)"
            >
              <mat-expansion-panel-header>
                <mat-panel-title>{{ item.title || '(no title)' }}</mat-panel-title>
                <mat-panel-description>
                  {{ item.contentTypeName || item.contentTypeStaticName }} &nbsp;
                  <small>({{ item.deletedUtc | date: 'short' }})</small>
                </mat-panel-description>
              </mat-expansion-panel-header>
              @if (expandedItems[item.id]) {
                <div class="recycle-bin-details">
                  <div class="recycle-bin-detail-row">
                    <div class="recycle-bin-detail-label">Content Type:</div>
                    <div class="recycle-bin-detail-value">{{ item.contentTypeName || item.contentTypeStaticName }}</div>
                  </div>
                  <div class="recycle-bin-detail-row">
                    <div class="recycle-bin-detail-label">Deleted By:</div>
                    <div class="recycle-bin-detail-value">{{ item.deletedBy }}</div>
                  </div>
                  <div class="recycle-bin-detail-row">
                    <div class="recycle-bin-detail-label">Deleted Date:</div>
                    <div class="recycle-bin-detail-value">{{ item.deletedUtc | date: 'medium' }}</div>
                  </div>
                  <div class="recycle-bin-detail-row">
                    <div class="recycle-bin-detail-label">Item ID:</div>
                    <div class="recycle-bin-detail-value">{{ item.id }}</div>
                  </div>
                </div>
                <div class="recycle-bin-actions">
                  <button mat-raised-button color="primary" (click)="restore(item)">
                    <mat-icon>restore_from_trash</mat-icon>
                    Restore
                  </button>
                </div>
              }
            </mat-expansion-panel>
          }
        </mat-accordion>
      }
    </div>
  </mat-card-content>
</mat-card>
<router-outlet></router-outlet>
