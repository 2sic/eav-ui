<div class="eav-cards-box" [class.eav-cards-box-expanded]="showConfigurationDropdown()">
  <mat-card class="eav-card">
    <mat-card-header class="eav-card-header">
      <mat-card-title>{{ title() }}</mat-card-title>
      <mat-icon>support_agent</mat-icon>
    </mat-card-header>
    <mat-card-content>
      <br />
      <!-- Generator select -->
      @if (showConfigurationDropdown()) {
        <div class="configuration-select">
          <mat-form-field color="accent" class="eav-mat-form-field">
            <mat-label>Select a Configuration Entity</mat-label>
            <mat-select [(value)]="selectedEntity">
              <mat-option [value]="undefined">
                Empty (press + to create new)
              </mat-option>
              @if (entities$ | async; as entities) {
                @for (entity of entities; track entity) {
                  <mat-option [value]="entity">
                    {{ entity.Title }}
                  </mat-option>
                }
              }
            </mat-select>
            <mat-hint>
              Entities of type <code>b08dcd23-2eb0-4a5e-a3d0-3178d2aae451</code>.
            </mat-hint>
          </mat-form-field>
          @if(selectedEntity) {
            <button
              mat-icon-button
              class="eav-icon"
              aria-label="Edit"
              (click)="editConfig(selectedEntity)"
            >
              <mat-icon>edit</mat-icon>
            </button>
            <button
              mat-icon-button
              class="eav-icon"
              aria-label="Delete"
              (click)="deleteConfiguration(selectedEntity)"
            >
              <mat-icon>delete</mat-icon>
            </button>
          } @else {
            <button
              mat-icon-button
              class="eav-icon"
              aria-label="Create"
              (click)="editConfig(null)"
            >
              <mat-icon>add</mat-icon>
            </button>
          }
        </div>
        <br />
      }

      <!-- Generator select -->
      @if (generators$ | async; as generators) {
        <mat-form-field color="accent" class="eav-mat-form-field">
          <mat-label>Generator</mat-label>
          <mat-select required [(value)]="selectedGenerator">
            <mat-select-trigger>
              {{ selectedGenerator }}
            </mat-select-trigger>
            @for (generator of generators.sort(); track generator) {
              <mat-option [value]="generator.name">
                <strong>{{ generator.name }} v{{ generator.version }}</strong
                ><br />
                {{ generator.description }}
              </mat-option>
            }
          </mat-select>
          @if (selectedGenerator$ | async; as selectedGenerator) {
            <mat-hint [innerHTML]="selectedGenerator.descriptionHtml"></mat-hint>
          }
        </mat-form-field>
        <br />
      }

      <br />
      <!-- Edition select -->
      @if (editions$ | async; as editions) {
        <mat-form-field color="accent" class="eav-mat-form-field">
          <mat-label>Select an Edition to generate code for</mat-label>
          <mat-select required [(value)]="selectedEdition">
            @for (edition of editions.sort(); track edition) {
              <mat-option [value]="edition.name">
                <strong>{{ edition.label }}</strong> ({{ edition.description }})
              </mat-option>
            }
          </mat-select>
          <mat-hint>
            Editions are managed in the <code>/App_Data/app.json</code> file. See
            <a href="https://go.2sxc.org/app-json" target="_blank">docs</a>.
          </mat-hint>
        </mat-form-field>
      }
    </mat-card-content>
    <div class="eav-card-space-div"></div>
    <mat-card-actions align="end">
      <button mat-button class="eav-button__with-icon" (click)="toggleConfigurationDropdown()">
        <mat-icon class="eav-icon">discover_tune</mat-icon>
        <span>Use Configuration</span>
      </button>
      <button mat-button class="eav-button__with-icon" (click)="autoGeneratedCode()">
        <mat-icon class="eav-icon">code</mat-icon>
        <span>Generate Code</span>
      </button>
    </mat-card-actions>
  </mat-card>
</div>
