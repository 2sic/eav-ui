<ng-container *ngIf="viewModel$ | async as vm">
  <div mat-mdc-dialog-title>
    <div class="dialog-title-box hide-scrollbar">
      <span>Create</span>
      <span class="file-name">{{
        controls.finalName.value
        || (controls.folder.value ? controls.folder.value.trim() + '/' : '')
        }}</span>
    </div>
  </div>

  <form [formGroup]="form" class="dialog-form">
    <div class="dialog-form-content fancy-scrollbar-light">

      <div class="field-container multiple">
        <!-- Platform -->
        <div class="multiple-field">
          <mat-form-field color="accent">
            <mat-label>Platform</mat-label>
            <mat-select formControlName="platform">
              <mat-option *ngFor="let platform of vm.platforms" [value]="platform">
                {{ platform }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <!-- Purpose -->
        <div class="multiple-field">
          <mat-form-field color="accent">
            <mat-label>Purpose</mat-label>
            <mat-select formControlName="purpose">
              <mat-option *ngFor="let purpose of vm.purposes" [value]="purpose">
                {{ purpose }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>
      </div>

      <!-- Template -->
      <div class="field-container">
        <mat-form-field color="accent">
          <mat-label>Template</mat-label>
          <mat-select formControlName="templateKey">
            <mat-option *ngFor="let template of vm.templates" [value]="template.Key">
              {{ template.Name }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>

      <!-- Name -->
      <div class="field-container">
        <mat-form-field color="accent">
          <mat-label>Name</mat-label>
          <input matInput type="text" formControlName="name" required appMatInputAutofocus autofocusSelectValue="true">
        </mat-form-field>
        <app-field-hint *ngIf="controls.name.touched && controls.name.errors?.required" [isError]="true">
          This field is required
        </app-field-hint>
      </div>
    </div>

    <div class="dialog-form-actions">
      <ng-container *ngIf="vm.loadingPreview">
        <mat-spinner mode="indeterminate" diameter="20" color="accent"></mat-spinner>
        <div class="spacer"></div>
      </ng-container>
      <button mat-raised-button type="button" (click)="closeDialog()">Cancel</button>
      <button mat-raised-button type="button" color="accent"
        [disabled]="!form.valid || vm.loadingPreview || !vm.previewValid" (click)="confirm()">
        Create
      </button>
    </div>

    <ng-container *ngIf="vm.preview">
      <div class="preview-label-box">
        <label class="preview-label" [ngClass]="{ 'disabled': vm.loadingPreview }">Preview</label>
      </div>
      <pre class="fancy-scrollbar-light" [ngClass]="{ 'disabled': vm.loadingPreview }">{{ vm.preview }}</pre>
    </ng-container>

    <div class="preview-error" *ngIf="!vm.loadingPreview && vm.previewError">
      {{ vm.previewError }}
    </div>
  </form>
</ng-container>