@if (viewModel$ | async; as vm) {
  <div class="eav-dialog eav-no-scrollbar">
    <div class="eav-dialog-header">
      <div class="eav-dialog-header__title eav-dialog-title-box">
        <span>Create</span>
        <span class="eav-file-name">
          {{ controls.finalName.value
              || (controls.folder.value ? controls.folder.value.trim() + '/' : '') }}
        </span>
      </div>
      <button mat-icon-button tippy="Close dialog" (click)="closeDialog()">
        <mat-icon>close</mat-icon>
      </button>
    </div>
    <form [formGroup]="ngForm">
      <div class="eav-dialog-content">
        <div class="eav-field-container">
          <!-- Platform -->
          <div>
            <mat-form-field color="accent" class="eav-mat-form-field">
              <mat-label>Platform</mat-label>
              <mat-select formControlName="platform">
                @for (platform of vm.platforms; track platform) {
                  <mat-option [value]="platform">
                    {{ platform }}
                  </mat-option>
                }
              </mat-select>
            </mat-form-field>
          </div>
          <!-- Purpose -->
          <div>
            <mat-form-field color="accent" class="eav-mat-form-field">
              <mat-label>Purpose</mat-label>
              <mat-select formControlName="purpose">
                @for (purpose of vm.purposes; track purpose) {
                  <mat-option [value]="purpose">
                    {{ purpose }}
                  </mat-option>
                }
              </mat-select>
            </mat-form-field>
          </div>
        </div>
        <!-- Template -->
        <div class="eav-field-container">
          <mat-form-field color="accent" class="eav-mat-form-field">
            <mat-label>Template</mat-label>
            <mat-select formControlName="templateKey">
              @for (template of vm.templates; track template) {
                <mat-option [value]="template.Key">
                  {{ template.Name }}
                </mat-option>
              }
            </mat-select>
          </mat-form-field>
        </div>
        <!-- Name -->
        <div class="eav-field-container">
          <mat-form-field color="accent" class="eav-mat-form-field">
            <mat-label>Name</mat-label>
            <input matInput type="text" formControlName="name" required appMatInputAutofocus
              autofocusSelectValue="true">
          </mat-form-field>
          @if (controls.name.touched && controls.name.errors?.required) {
            <app-field-hint [isError]="true">
              This field is required
            </app-field-hint>
          }
        </div>
        @if (vm.preview) {
          <div class="eav-preview-container">
            <div class="eav-preview-label-box">
              <label class="eav-preview-label" [ngClass]="{ 'disabled': vm.loadingPreview }">Preview</label>
            </div>
            <pre class="fancy-scrollbar-light" [ngClass]="{ 'disabled': vm.loadingPreview }">{{ vm.preview }}</pre>
          </div>
        }
        @if (!vm.loadingPreview && vm.previewError) {
          <div class="eav-preview-error">
            {{ vm.previewError }}
          </div>
        }
        @if (vm.loadingPreview) {
          <div>
            <mat-spinner mode="indeterminate" diameter="20" color="accent"></mat-spinner>
            <div class="spacer"></div>
          </div>
        }
      </div>
      <mat-dialog-actions align="end">
        <app-save-close-button-fab
          [ngClass]="!canSave() ? 'disabled' : ''"
          [disabled]="!canSave()"
          [label]="'Form.Buttons.CreateAndClose'"
          (action)="saveAndClose()"
        />
      </mat-dialog-actions>
    </form>
  </div>
}